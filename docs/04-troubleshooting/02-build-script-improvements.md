# æ„å»ºè„šæœ¬ä¼˜åŒ–è¯´æ˜

> ğŸ”§ **é‡è¦æ›´æ–°** - æ„å»ºè„šæœ¬å’ŒAPIè·¯ç”±ç®¡ç†çš„æœ€æ–°æ”¹è¿›

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

### ä¸»è¦å˜åŒ–

1. **APIè·¯ç”±ç®¡ç†åˆ†ç¦»** - ä»æ„å»ºè„šæœ¬ä¸­ç§»é™¤APIç›®å½•çš„ä¸´æ—¶å¤„ç†é€»è¾‘
2. **ä¸“ç”¨ç®¡ç†è„šæœ¬** - ä½¿ç”¨ `scripts/manage-api.sh` ç»Ÿä¸€ç®¡ç†APIè·¯ç”±
3. **æ„å»ºè„šæœ¬ç®€åŒ–** - `build-wsl.sh` ä¸“æ³¨äºæ„å»ºæµç¨‹ï¼Œä¸å†å¤„ç†APIç›®å½•
4. **é”™è¯¯å¤„ç†ä¼˜åŒ–** - æ›´æ¸…æ™°çš„é”™è¯¯æç¤ºå’ŒçŠ¶æ€æ£€æŸ¥
5. **è‡ªåŠ¨APIè·¯ç”±ç®¡ç†** - æ„å»ºè„šæœ¬ç°åœ¨ä¼šè‡ªåŠ¨å¤„ç†APIè·¯ç”±çš„é“¾æ¥å’Œå–æ¶ˆé“¾æ¥

## ğŸ”„ APIè·¯ç”±ç®¡ç†æœºåˆ¶

### è®¾è®¡åŸç†

é¡¹ç›®é‡‡ç”¨**åˆ†ç¦»å¼APIè·¯ç”±ç®¡ç†**ï¼Œè§£å†³åŠ¨é™æ¨¡å¼å…¼å®¹é—®é¢˜ï¼š

- **æºç›®å½•**: `api/` (é¡¹ç›®æ ¹ç›®å½•)
- **ç›®æ ‡ç›®å½•**: `app/api/` (Next.js App Routerè¦æ±‚)
- **ç®¡ç†æ–¹å¼**: è½¯é“¾æ¥ (æ¨è) æˆ–ç›®å½•å¤åˆ¶

### ç®¡ç†å‘½ä»¤

```bash
# æ£€æŸ¥APIè·¯ç”±çŠ¶æ€
bash scripts/manage-api.sh status

# å¯ç”¨åŠ¨æ€æ¨¡å¼ (åˆ›å»ºè½¯é“¾æ¥)
bash scripts/manage-api.sh link

# ç¦ç”¨åŠ¨æ€æ¨¡å¼ (ç§»é™¤é“¾æ¥)
bash scripts/manage-api.sh unlink

# åˆå§‹åŒ–APIå¼€å‘ç¯å¢ƒ
bash scripts/manage-api.sh init
```

### çŠ¶æ€è¯´æ˜

| çŠ¶æ€                | æè¿°                 | é€‚ç”¨æ¨¡å¼ | æ“ä½œå»ºè®®       |
| ------------------- | -------------------- | -------- | -------------- |
| ğŸ”— å·²é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰ | `app/api` -> `api/`  | åŠ¨æ€æ¨¡å¼ | å¯ä»¥å¼€å‘API    |
| ğŸ“ å·²å¤åˆ¶ï¼ˆç›®å½•ï¼‰   | `app/api` æ˜¯ç‹¬ç«‹ç›®å½• | åŠ¨æ€æ¨¡å¼ | å»ºè®®æ”¹ä¸ºè½¯é“¾æ¥ |
| ğŸ“¦ æœªé“¾æ¥           | `app/api` ä¸å­˜åœ¨     | é™æ€æ¨¡å¼ | å¯ä»¥é™æ€æ„å»º   |

## ğŸ—ï¸ æ„å»ºæµç¨‹ä¼˜åŒ–

### æ—§ç‰ˆæœ¬æ„å»ºæµç¨‹ (å·²è¿‡æ—¶)

```bash
# æ—§ç‰ˆ build-wsl.sh (æœ‰é—®é¢˜çš„é€»è¾‘)
if [ "$EXPORT" = "true" ]; then
    mv app/api /tmp/blog-api-backup    # ä¸´æ—¶ç§»é™¤
fi

# ... æ„å»ºè¿‡ç¨‹ ...

# æ¸…ç†å‡½æ•°ä¸­æ¢å¤APIç›®å½•
if [ -d "/tmp/blog-api-backup" ]; then
    mv /tmp/blog-api-backup app/api    # æ¢å¤APIç›®å½•
fi
```

**é—®é¢˜**:

- æ„å»ºå¤±è´¥æ—¶å¯èƒ½æ— æ³•æ¢å¤APIç›®å½•
- é€»è¾‘å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™
- ä¸APIç®¡ç†è„šæœ¬èŒè´£é‡å 

### æ–°ç‰ˆæœ¬æ„å»ºæµç¨‹ (æ¨è)

```bash
# æ–°ç‰ˆ build-wsl.sh (ç®€åŒ–é€»è¾‘)
if [ "$EXPORT" = "true" ]; then
    echo "ğŸ“¦ é™æ€æ„å»ºæ¨¡å¼ï¼šç¡®ä¿æ²¡æœ‰APIè·¯ç”±"
    bash scripts/manage-api.sh unlink
else
    echo "ğŸ”— åŠ¨æ€æ„å»ºæ¨¡å¼ï¼šé“¾æ¥APIè·¯ç”±"
    bash scripts/manage-api.sh link
fi
```

**ä¼˜åŠ¿**:

- èŒè´£å•ä¸€ï¼Œåªè´Ÿè´£æ„å»º
- è‡ªåŠ¨å¤„ç†APIè·¯ç”±é“¾æ¥/å–æ¶ˆé“¾æ¥
- é”™è¯¯å¤„ç†ç®€å•æ˜ç¡®
- ä¾èµ–å¤–éƒ¨APIç®¡ç†è„šæœ¬
- æ›´å®‰å…¨å¯é 

## âš¡ å¿«é€Ÿä¿®å¤æŒ‡å—

### é™æ€æ„å»ºå¤±è´¥

```bash
# é—®é¢˜: é™æ€æ„å»ºæ—¶æ£€æµ‹åˆ°APIç›®å½•
# é”™è¯¯ä¿¡æ¯: "æ£€æµ‹åˆ°app/apiç›®å½•ï¼Œè¯·å…ˆè¿è¡Œ..."

# è§£å†³æ–¹æ¡ˆ (ç°åœ¨è‡ªåŠ¨å¤„ç†)
pnpm run build:static
```

### åŠ¨æ€æ¨¡å¼APIä¸å¯ç”¨

```bash
# é—®é¢˜: åŠ¨æ€æ¨¡å¼ä¸‹APIè·¯ç”±404
# ç—‡çŠ¶: /api/health è¿”å›404é”™è¯¯

# è§£å†³æ–¹æ¡ˆ (ç°åœ¨è‡ªåŠ¨å¤„ç†)
pnpm run build:dynamic
pnpm run serve:dynamic
```

### APIç›®å½•çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥å½“å‰çŠ¶æ€
bash scripts/manage-api.sh status

# è¾“å‡ºç¤ºä¾‹:
# ğŸ“Š API è·¯ç”±çŠ¶æ€æ£€æŸ¥:
#   æºç›®å½•: api âœ… å­˜åœ¨
#   ç›®æ ‡ç›®å½•: app/api âœ… å­˜åœ¨
#   ç±»å‹: è½¯é“¾æ¥ -> ../../api
#   çŠ¶æ€: ğŸ”— å·²é“¾æ¥ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
#   APIæ•°é‡: 2 ä¸ªè·¯ç”±æ–‡ä»¶
```

## ğŸ”§ å¼€å‘å·¥ä½œæµç¨‹

### é™æ€æ¨¡å¼å¼€å‘

```bash
# 1. å¼€å‘å’Œæµ‹è¯•
pnpm dev

# 2. æ„å»ºéƒ¨ç½² (è‡ªåŠ¨å¤„ç†APIè·¯ç”±)
pnpm run build:static
```

### åŠ¨æ€æ¨¡å¼å¼€å‘

```bash
# 1. å¼€å‘å’Œæµ‹è¯•
pnpm dev

# 2. æ„å»ºéƒ¨ç½² (è‡ªåŠ¨å¤„ç†APIè·¯ç”±)
pnpm run build:dynamic
pnpm run serve:dynamic
```

### æ¨¡å¼åˆ‡æ¢

```bash
# æ‰‹åŠ¨åˆ‡æ¢æ¨¡å¼
bash scripts/manage-api.sh unlink  # åˆ‡æ¢åˆ°é™æ€æ¨¡å¼
bash scripts/manage-api.sh link    # åˆ‡æ¢åˆ°åŠ¨æ€æ¨¡å¼
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥åˆ é™¤APIç›®å½•ï¼Ÿ

**A**: APIæºç åœ¨ `api/` ç›®å½•ä¸­ï¼Œ`app/api/` åªæ˜¯è½¯é“¾æ¥ã€‚åˆ é™¤ `app/api/` ä¸ä¼šä¸¢å¤±æºç ï¼Œä½†ç›´æ¥åˆ é™¤ `api/` ä¼šå¯¼è‡´æºç ä¸¢å¤±ã€‚

### Q: è½¯é“¾æ¥å’Œç›®å½•å¤åˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**:

- **è½¯é“¾æ¥**: å®æ—¶åŒæ­¥ï¼Œä¿®æ”¹æºæ–‡ä»¶ç«‹å³ç”Ÿæ•ˆï¼Œæ¨èç”¨äºå¼€å‘
- **ç›®å½•å¤åˆ¶**: ç‹¬ç«‹å‰¯æœ¬ï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼Œå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´

### Q: æ„å»ºå¤±è´¥åå¦‚ä½•æ¢å¤ï¼Ÿ

**A**:

```bash
# 1. æ£€æŸ¥APIçŠ¶æ€
bash scripts/manage-api.sh status

# 2. æ ¹æ®éœ€è¦çš„æ¨¡å¼è°ƒæ•´ (é€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ)
bash scripts/manage-api.sh unlink  # é™æ€æ¨¡å¼
# æˆ–
bash scripts/manage-api.sh link    # åŠ¨æ€æ¨¡å¼

# 3. æ¸…ç†é‡å»º
pnpm clean
pnpm run build:static  # æˆ– build:dynamic
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å‘½ä»¤å‚è€ƒæ‰‹å†Œ](../01-getting-started/02-commands-reference.md)
- [åŒæ¨¡å¼æ¶æ„è®¾è®¡](../03-architecture/01-run-mode-architecture.md)
- [éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ](../02-deployment/00-deployment-overview.md)

---

ğŸ’¡ **å»ºè®®**: åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå»ºè®®ä½¿ç”¨ `bash scripts/manage-api.sh status` å‘½ä»¤å®šæœŸæ£€æŸ¥APIè·¯ç”±çŠ¶æ€ï¼Œç¡®ä¿å½“å‰æ¨¡å¼é…ç½®æ­£ç¡®ã€‚æ–°çš„æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†APIè·¯ç”±çš„é“¾æ¥å’Œå–æ¶ˆé“¾æ¥ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚
